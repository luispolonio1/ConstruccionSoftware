{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Videollamada - {{ room_name }}</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sf': ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'Segoe UI', 'sans-serif']
          },
          colors: {
            'primary': '#F54927',
            'secondary': '#053470'
          },
          animation: {
            'pulse-dot': 'pulse-dot 2s infinite',
            'mic-pulse': 'mic-pulse 1.5s infinite',
            'fade-in': 'fade-in 0.8s ease-out',
            'slide-up': 'slide-up 1s ease-out 0.2s both',
            'speaking-pulse': 'speaking-pulse 2s infinite'
          },
          keyframes: {
            'pulse-dot': {
              '0%, 100%': { opacity: '0.4' },
              '50%': { opacity: '1' }
            },
            'mic-pulse': {
              '0%, 100%': { transform: 'scale(1)', opacity: '0.9' },
              '50%': { transform: 'scale(1.3)', opacity: '0.5' }
            },
            'fade-in': {
              'from': { opacity: '0', transform: 'scale(0.98)' },
              'to': { opacity: '1', transform: 'scale(1)' }
            },
            'slide-up': {
              'from': { opacity: '0', transform: 'translateX(-50%) translateY(10px)' },
              'to': { opacity: '1', transform: 'translateX(-50%) translateY(0)' }
            },
            'speaking-pulse': {
              '0%, 100%': { opacity: '0', transform: 'scale(1)' },
              '50%': { opacity: '1', transform: 'scale(1.02)' }
            }
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #000000;
      color: #ffffff;
    }
    
    .video-container {
      background-color: #000;
    }
    
    .border-minimal {
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .btn-primary {
      background-color: #053470;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #04295c;
    }
    
    .btn-secondary {
      background-color: rgba(5, 52, 112);
      color: white;
      border: 1px solid #053470;
    }
    .btn-success {
      background-color: rgba(5, 112, 52); /* Verde con transparencia */
      color: white;
      border: 1px solid #057034;              /* Verde más fuerte */
    }

    
    .btn-secondary:hover {
      background-color: rgba(5, 52, 112, 0.3);
    }

    .btn-success:hover {
      background-color: rgba(5, 112, 52, 0.3); /* Verde con más transparencia al pasar el mouse */
    }
    
    .btn-accent {
      background-color: #F54927;
      color: white;
    }
    
    .btn-accent:hover {
      background-color: #e04122;
    }
    
    .text-accent {
      color: #F54927;
    }
    
    .bg-secondary-transparent {
      background-color: rgba(5, 52, 112, 0.1);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col lg:flex-row overflow-hidden font-sf">
    <!-- Alertas -->
    <div class="fixed top-0 left-0 right-0 z-50 p-4 flex justify-center">
        <div id='alerta' class="hidden inline-block px-4 py-2 btn-success text-white rounded text-sm">
        </div>
    </div>
    <div class="fixed top-0 left-0 right-0 z-50 p-4 flex justify-center">
        <div id='Informacion' class="hidden inline-block px-4 py-2 btn-secondary text-white rounded text-sm">
        </div>
    </div>
  
  <!-- Sidebar para participantes -->
  <aside id="sidebar" class="hidden lg:flex w-80 bg-black border-minimal border-r flex-col flex-shrink-0">
    <!-- Header -->
    <div class="p-6 border-b border-minimal">
      <h2 class="text-xl font-semibold text-white mb-1">Participantes</h2>
      <p class="text-sm text-gray-400">{{users.count|default:"desconocidos"}}</p>
    </div>
    
    <!-- Lista de participantes -->
    <div class="flex-1 overflow-y-auto p-4 space-y-3">
      {% for user in users %}
      <div class="bg-secondary-transparent border-minimal rounded p-3">
        <div class="flex items-center gap-3">
          <div class="relative">
            <div class="w-10 h-10 bg-secondary rounded-full flex items-center justify-center text-white font-medium text-sm">
              {% if user.is_authenticated %}
                {{ user.username|slice:":1"|upper }}
              {% else %}
                IN
              {% endif %}
            </div>
            <!-- Indicador de conexión -->
            <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-black rounded-full"></div>
          </div>
          <div class="flex-1 min-w-0">
            {% if user.is_authenticated %}
              <p class="font-medium text-white truncate">
                {% if user == request.user %}
                  TÚ ({{ user.username }})
                {% else %}
                  {{ user.username }}
                {% endif %}
              </p>
            {% else %}
              <p class="font-medium text-white truncate">Invitado</p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    
    <!-- Información de sala -->
    <div class="p-4 border-t border-minimal">
      <div class="bg-secondary-transparent border-minimal rounded p-3">
        <div class="flex items-center justify-between mb-2">
          <p class="text-xs font-medium text-gray-400">Sala:</p>
          <div class="flex items-center gap-1">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-xs text-green-400">En vivo</span>
          </div>
        </div>
        <p class="text-sm text-white font-mono truncate" id="room-name">{{ room_name }}</p>
        <button class="btn-secondary w-full mt-3 rounded py-2 text-sm transition-colors">
          Invitar usuarios
        </button>
      </div>
    </div>
  </aside>

  <!-- Contenido principal -->
  <main class="flex-1 flex flex-col min-h-0 relative">
    <!-- Botón para mostrar/ocultar sidebar en móviles -->
    <button id="sidebarToggle" class="lg:hidden absolute top-4 left-4 z-40 w-10 h-10 bg-black border border-minimal rounded flex items-center justify-center text-white">
      👥
    </button>

    <!-- Contenedor de videos -->
    <div class="flex-1 flex flex-col gap-3 p-3 lg:flex-row lg:gap-6 lg:p-6 min-h-0">
      <!-- Video remoto -->
      <div class="flex-1 relative rounded overflow-hidden bg-black border border-minimal transition-all duration-300 min-h-[40vh] lg:min-h-0 video-container">
        <video id="remoteVideo" autoplay playsinline class="w-full h-full object-contain bg-black rounded"></video>
        
        <!-- Etiqueta de video -->
        <div class="absolute top-3 left-3 bg-black/70 text-white px-2.5 py-1.5 rounded text-xs font-medium flex items-center gap-2 border border-minimal">
          <div class="w-1.5 h-1.5 bg-white rounded-full animate-mic-pulse"></div>
          <span>Usuario Remoto</span>
        </div>
        
        <!-- Marcador de posición de video -->
        <div id="remotePlaceholder" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center text-gray-400 text-sm font-medium hidden">
          <div class="text-2xl lg:text-3xl mb-2">📷</div>
          <span>Esperando video...</span>
        </div>
      </div>

      <!-- Video local -->
      <div id="localVideoWrapper" class="flex-1 relative rounded overflow-hidden bg-black border border-minimal transition-all duration-300 min-h-[40vh] lg:min-h-0 video-container">
        <video id="localVideo" autoplay playsinline muted class="w-full h-full object-cover bg-black rounded"></video>
        
        <!-- Etiqueta de video -->
        <div class="absolute top-3 left-3 bg-black/70 text-white px-2.5 py-1.5 rounded text-xs font-medium flex items-center gap-2 border border-minimal">
          <div id="localMicIndicator" class="w-1.5 h-1.5 bg-gray-400 rounded-full"></div>
          <span>Tú</span>
        </div>
        
        <!-- Marcador de posición de video -->
        <div id="localPlaceholder" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center text-gray-400 text-sm font-medium hidden">
          <div class="text-2xl lg:text-3xl mb-2">📷</div>
          <span>Sin cámara</span>
        </div>
      </div>
    </div>

    <!-- Controles -->
    <div class="sticky bottom-0 left-0 right-0 pb-4 pt-2 bg-gradient-to-t from-black to-transparent pointer-events-none">
      <div class="flex justify-center">
        <div class="flex gap-2 bg-black px-4 py-3 rounded-xl border border-minimal animate-slide-up pointer-events-auto">
          <!-- Botón de silencio -->
          <button id="muteBtn" class="btn-primary w-12 h-12 rounded-full flex items-center justify-center text-xl transition-colors" title="Silenciar/Activar micrófono" aria-label="Silenciar micrófono">
              <i class="material-icons">mic</i>
          </button>
          
          <!-- Botón de video -->
          <button id="videoBtn" class="btn-primary w-12 h-12 rounded-full flex items-center justify-center text-xl transition-colors" title="Activar/Desactivar cámara" aria-label="Activar cámara">
            <i class="material-icons">videocam</i>
          </button>
          
          <!-- Botón de finalizar llamada -->
          <button id="endBtn" class="btn-accent w-12 h-12 rounded-full flex items-center justify-center text-xl transition-colors" title="Finalizar llamada" aria-label="Finalizar llamada">
            <i class="material-icons">call_end</i>
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Datos de la sala -->
  <div id="room-data" data-room="{{ room_name }}" class="hidden"></div>
  
  <!-- Scripts -->
  <script src="{% static 'videocall/llamadas.js' %}" defer></script>
  <script src="{% static 'videocall/tools.js' %}" defer></script>
</body>
</html>